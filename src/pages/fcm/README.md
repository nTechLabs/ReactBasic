# FCM ì•Œë¦¼ ê¸°ëŠ¥ ê°€ì´ë“œ

## ğŸ“± ê°œìš”

Firebase Cloud Messaging (FCM) ì•Œë¦¼ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì˜ Notification APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì•Œë¦¼ì„ í‘œì‹œí•˜ê³ , ë”¥ë§í¬ë¥¼ í†µí•´ ì•± ì‹¤í–‰ ë˜ëŠ” ì›¹ í˜ì´ì§€ ì´ë™ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### 1. **ë¸Œë¼ìš°ì € ì•Œë¦¼ (Notification API)**
- ë¸Œë¼ìš°ì €ì—ì„œ ë„¤ì´í‹°ë¸Œ ì•Œë¦¼ í‘œì‹œ
- ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ë° ê´€ë¦¬
- ì•Œë¦¼ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬

### 2. **ë”¥ë§í¬ ì²˜ë¦¬ (Deep Linking)**
- ì•±ì´ ì„¤ì¹˜ëœ ê²½ìš°: ì•± ì‹¤í–‰ + íŠ¹ì • í˜ì´ì§€ë¡œ ì´ë™
- ì•±ì´ ì—†ëŠ” ê²½ìš°: ìŠ¤ë§ˆíŠ¸ ìŠ¤í† ì–´ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- Custom URL Scheme ì§€ì› (ì˜ˆ: `myapp://order/12345`)

### 3. **ëª¨ë“ˆí™”ëœ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬**
- `kkoAlarmMessageHandler.jsx`: ì•Œë¦¼ ë©”ì‹œì§€ ì²˜ë¦¬ ë¡œì§ ë¶„ë¦¬
- í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ë…ë¦½ì ì¸ ëª¨ë“ˆ êµ¬ì¡°
- ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ ì§€ì›

## ğŸ“‚ íŒŒì¼ êµ¬ì¡°

```
src/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ fcm/
â”‚       â””â”€â”€ FCMPage.jsx          # FCM í…ŒìŠ¤íŠ¸ í˜ì´ì§€ UI
â””â”€â”€ utils/
    â””â”€â”€ kkoAlarmMessageHandler.jsx  # ì•Œë¦¼ ë©”ì‹œì§€ ì²˜ë¦¬ ë¡œì§
```

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. í˜ì´ì§€ ì ‘ê·¼
- ëŒ€ì‹œë³´ë“œì—ì„œ "FCM ì•Œë¦¼" ì¹´ë“œ í´ë¦­
- ë˜ëŠ” ì§ì ‘ `/fcm` ê²½ë¡œë¡œ ì´ë™
- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ì˜ "FCM ì•Œë¦¼" ë©”ë‰´ í´ë¦­

### 2. ì•Œë¦¼ ê¶Œí•œ í—ˆìš©
1. í˜ì´ì§€ ë¡œë“œ ì‹œ ì•Œë¦¼ ê¶Œí•œ ìƒíƒœ í™•ì¸
2. ê¶Œí•œì´ ì—†ëŠ” ê²½ìš° "ì•Œë¦¼ ê¶Œí•œ ìš”ì²­" ë²„íŠ¼ í´ë¦­
3. ë¸Œë¼ìš°ì € íŒì—…ì—ì„œ "í—ˆìš©" ì„ íƒ

### 3. í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡
ì„¸ ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ì˜ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì œê³µ:
- **ì•± ìˆìŒ - ì£¼ë¬¸ ì•Œë¦¼**: ì•± ì‹¤í–‰ í›„ ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™
- **ì•± ì—†ìŒ - í”„ë¡œëª¨ì…˜ ì•Œë¦¼**: ìŠ¤ë§ˆíŠ¸ ìŠ¤í† ì–´ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- **ì•± ìˆìŒ - ìƒí’ˆ ì¬ì…ê³ **: ì•± ì‹¤í–‰ í›„ ìƒí’ˆ í˜ì´ì§€ë¡œ ì´ë™

### 4. ì•Œë¦¼ í´ë¦­
- ë¸Œë¼ìš°ì € ì•Œë¦¼ í´ë¦­ ì‹œ ë”¥ë§í¬ ì²˜ë¦¬ ì‹¤í–‰
- ë˜ëŠ” í˜ì´ì§€ì˜ ë©”ì‹œì§€ ëª©ë¡ì—ì„œ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸

## ğŸ”§ kkoAlarmMessageHandler ëª¨ë“ˆ

### ì£¼ìš” í•¨ìˆ˜

#### `handleKkoAlarmMessage(options)`
ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë©”ì¸ í•¨ìˆ˜

**Parameters:**
```javascript
{
  deeplink: string,   // ë”¥ë§í¬ URL (ì˜ˆ: "myapp://order/12345")
  hasApp: boolean,    // ì•± ì„¤ì¹˜ ì—¬ë¶€
  storeUrl: string    // ì•±ì´ ì—†ì„ ë•Œ ì´ë™í•  ìŠ¤í† ì–´ URL
}
```

**Example:**
```javascript
import { handleKkoAlarmMessage } from '../../utils/kkoAlarmMessageHandler';

// ì•±ì´ ìˆëŠ” ê²½ìš°
handleKkoAlarmMessage({
  deeplink: 'myapp://order/12345',
  hasApp: true
});

// ì•±ì´ ì—†ëŠ” ê²½ìš°
handleKkoAlarmMessage({
  deeplink: 'myapp://promotion/special',
  hasApp: false,
  storeUrl: 'https://smartstore.naver.com/mystore'
});
```

### ë”¥ë§í¬ í˜•ì‹

ì§€ì›í•˜ëŠ” ë”¥ë§í¬ íŒ¨í„´:
```
myapp://order/12345
myapp://product/67890
myapp://promotion/special
myapp://search?q=shoes&category=fashion
```

### ê°œë°œì ë„êµ¬

ê°œë°œ ëª¨ë“œì—ì„œ ì½˜ì†”ì—ì„œ ì§ì ‘ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥:

```javascript
// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‹¤í–‰
window.testDeeplinkScenarios();  // ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

window.handleKkoAlarmMessage({
  deeplink: 'myapp://custom/test',
  hasApp: true
});
```

## ğŸ¨ UI ì»´í¬ë„ŒíŠ¸

### FCMPage êµ¬ì„±ìš”ì†Œ

1. **ì•Œë¦¼ ê¶Œí•œ ìƒíƒœ ì¹´ë“œ**
   - í˜„ì¬ ê¶Œí•œ ìƒíƒœ í‘œì‹œ (í—ˆìš©/ê±°ë¶€/ë¯¸ì„¤ì •)
   - ê¶Œí•œ ìš”ì²­ ë²„íŠ¼

2. **í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ ì¹´ë“œ**
   - 3ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ ë²„íŠ¼
   - ë™ì‘ ë°©ì‹ ì„¤ëª…

3. **ìˆ˜ì‹ ëœ ë©”ì‹œì§€ ëª©ë¡**
   - ìˆ˜ì‹ í•œ ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬
   - í´ë¦­í•˜ì—¬ ë”¥ë§í¬ ì²˜ë¦¬ ì¬ì‹¤í–‰
   - ë©”ì‹œì§€ ì´ˆê¸°í™” ê¸°ëŠ¥

4. **êµ¬í˜„ ê¸°ëŠ¥ ì„¤ëª… ì¹´ë“œ**
   - êµ¬í˜„ëœ ê¸°ëŠ¥ ëª©ë¡
   - ì‚¬ìš©ëœ ê¸°ìˆ  ì„¤ëª…

## ğŸ” ë™ì‘ ì›ë¦¬

### 1. ì•±ì´ ì„¤ì¹˜ëœ ê²½ìš° (`hasApp: true`)

```
ì•Œë¦¼ í´ë¦­
  â†“
ë”¥ë§í¬ íŒŒì‹±
  â†“
iframeì„ í†µí•œ ì•± ì‹¤í–‰ ì‹œë„
  â†“
í˜ì´ì§€ visibility ê°ì§€
  â†“
ì•± ì‹¤í–‰ ì„±ê³µ â†’ ì™„ë£Œ
ì•± ì‹¤í–‰ ì‹¤íŒ¨ â†’ ì›¹ ëŒ€ì²´ í˜ì´ì§€ë¡œ ì´ë™
```

### 2. ì•±ì´ ì—†ëŠ” ê²½ìš° (`hasApp: false`)

```
ì•Œë¦¼ í´ë¦­
  â†“
ìŠ¤ë§ˆíŠ¸ ìŠ¤í† ì–´ URLë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  â†“
ìƒˆ íƒ­ì—ì„œ ìŠ¤í† ì–´ í˜ì´ì§€ ì—´ë¦¼
```

## ğŸŒ ë¸Œë¼ìš°ì € í˜¸í™˜ì„±

- **Chrome/Edge**: ì™„ë²½ ì§€ì›
- **Firefox**: ì™„ë²½ ì§€ì›
- **Safari**: ë¶€ë¶„ ì§€ì› (ì•Œë¦¼ ê¶Œí•œ ì²˜ë¦¬ ë°©ì‹ ë‹¤ë¦„)
- **ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €**: ì œí•œì  ì§€ì› (OS ì„¤ì • í•„ìš”)

## ğŸ“± ì‹¤ì œ FCM í†µí•© ê°€ì´ë“œ

í˜„ì¬ëŠ” ë¸Œë¼ìš°ì € Notification APIë¥¼ ì‚¬ìš©í•œ ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤.
ì‹¤ì œ FCMì„ í†µí•©í•˜ë ¤ë©´:

1. **Firebase í”„ë¡œì íŠ¸ ì„¤ì •**
   ```bash
   npm install firebase
   ```

2. **Firebase ì´ˆê¸°í™”**
   ```javascript
   import { initializeApp } from 'firebase/app';
   import { getMessaging, getToken } from 'firebase/messaging';
   
   const firebaseConfig = {
     // Firebase ì½˜ì†”ì—ì„œ ë³µì‚¬
   };
   
   const app = initializeApp(firebaseConfig);
   const messaging = getMessaging(app);
   ```

3. **FCM í† í° íšë“**
   ```javascript
   const token = await getToken(messaging, {
     vapidKey: 'YOUR_VAPID_KEY'
   });
   ```

4. **ë©”ì‹œì§€ ìˆ˜ì‹  ì²˜ë¦¬**
   ```javascript
   onMessage(messaging, (payload) => {
     handleKkoAlarmMessage({
       deeplink: payload.data.deeplink,
       hasApp: payload.data.hasApp === 'true',
       storeUrl: payload.data.storeUrl
     });
   });
   ```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì£¼ë¬¸ ì•Œë¦¼ (ì•± ìˆìŒ)
- **Deeplink**: `myapp://order/12345`
- **ì˜ˆìƒ ë™ì‘**: ì•± ì‹¤í–‰ â†’ ì£¼ë¬¸ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™

### ì‹œë‚˜ë¦¬ì˜¤ 2: í”„ë¡œëª¨ì…˜ (ì•± ì—†ìŒ)
- **Deeplink**: `myapp://promotion/special`
- **Store URL**: `https://smartstore.naver.com/mystore`
- **ì˜ˆìƒ ë™ì‘**: ìŠ¤ë§ˆíŠ¸ ìŠ¤í† ì–´ í˜ì´ì§€ ì—´ë¦¼

### ì‹œë‚˜ë¦¬ì˜¤ 3: ìƒí’ˆ ì¬ì…ê³  (ì•± ìˆìŒ)
- **Deeplink**: `myapp://product/67890`
- **ì˜ˆìƒ ë™ì‘**: ì•± ì‹¤í–‰ â†’ ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì•Œë¦¼ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ
- ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œ í™•ì¸
- ì‹œìŠ¤í…œ ì•Œë¦¼ ì„¤ì • í™•ì¸
- HTTPS í™˜ê²½ì¸ì§€ í™•ì¸ (localhostëŠ” ì˜ˆì™¸)

### ì•±ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
- Custom URL Scheme ë“±ë¡ í™•ì¸
- ì•±ì´ ì‹¤ì œë¡œ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- ëª¨ë°”ì¼ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹œ OS ë²„ì „ í™•ì¸

### ìŠ¤í† ì–´ë¡œ ì´ë™í•˜ì§€ ì•ŠìŒ
- íŒì—… ì°¨ë‹¨ ì„¤ì • í™•ì¸
- storeUrlì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

## ğŸ“ ì£¼ì˜ì‚¬í•­

1. **ë³´ì•ˆ**: ë”¥ë§í¬ URL ê²€ì¦ í•„ìš” (ì‹¤ì œ í”„ë¡œë•ì…˜ì—ì„œ)
2. **ì—ëŸ¬ ì²˜ë¦¬**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, ê¶Œí•œ ê±°ë¶€ ë“± ì²˜ë¦¬
3. **ì‚¬ìš©ì ê²½í—˜**: ì•Œë¦¼ ë¹ˆë„ ì¡°ì ˆ, ì¤‘ìš”ë„ì— ë”°ë¥¸ ë¶„ë¥˜
4. **í…ŒìŠ¤íŠ¸**: ë‹¤ì–‘í•œ ë””ë°”ì´ìŠ¤ì™€ ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸ í•„ìˆ˜

## ğŸ”— ì°¸ê³  ìë£Œ

- [MDN Web Docs - Notifications API](https://developer.mozilla.org/en-US/docs/Web/API/Notifications_API)
- [Firebase Cloud Messaging](https://firebase.google.com/docs/cloud-messaging)
- [Deep Linking Best Practices](https://developer.android.com/training/app-links)
